# これは何か

Webサーバ - APサーバ - DBサーバを学ぶ場所

よくあるwebアプリケーションの3層構造をなんとなく実現できるようになることを目標にする。

# 環境構成

サーバはWebサーバ(apache)とAPサーバ(tomcat + PostgresSQL)の２台

想定としてWebサーバはDMZに置かれるがAPサーバはLAN(internal)に置かれるだろうという想定のため今回はAPサーバにDBを同居させた

|役割|host名|IPアドレス|確認用ポートフォワーディングの設定|
|-|-|-|-|
|Webサーバ|web|192.168.33.10|ローカルマシン:30080 -> VM:80 (http)|
|APサーバ|ap|192.168.33.11|ローカルマシン:38080 -> VM:8080 (http)|

## Webサーバ

* プライベートIPアドレス: `192.168.33.10`
* 解放するポートは22(ssh)と80(http)のみ（ファイアウォールで許可するもの）
* `/example/action/*` のリクエストをリバースプロキシでAPサーバへ送る(apacheにリバースプロキシの設定を入れる)
* `/example/css/*` と `/example/js/*` のリクエストはWebサーバのリソースを返却する

## APサーバ

* プライベートIPアドレス: `192.168.33.11`
* 解放するポートは22(ssh)と8080(http)のみ（ファイアウォールで許可するがプライベートネットワークからの接続のみ受け付ける）
* tomcatからDBへの接続はtomcatに設定のjndiで

apache + tomcatの構成ならHTTPでなくAJPで通信した方が良いかと思ったが接続確認をwebサーバを介さずに行いたかった。


# 参考
## Tomcatの参考
* https://qiita.com/msakamoto_sf/items/ef34922548275dd31014